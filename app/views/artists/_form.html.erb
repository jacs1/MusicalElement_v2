<div class="wrap">
<div class="content container-fluid">
    <div class="row-fluid">
        <div class="span12">
            <h2 class="page-title">Account Demo <small>Out of the box form</small></h2>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span6">
            <section class="widget">
                <header>
                    <h4><i class="icon-user"></i> Account Profile <small>Create new or edit existing user</small></h4>
                </header>
                <div class="body">
                    <!-- <form id="user-form" class="form-horizontal label-left"
                          novalidate="novalidate"
                          method="put"
                          data-validate="parsley"> -->

                  <div class="row-fluid">
                    <div class="span4">
                      <div class="text-align-center">
                        <% if @artist.artist_images.empty? %>
                          <img src="img/10.jpg" alt="">          
                            <% else %>
                              <img src="<%= @artist.artist_images.first.image %>" alt="64x64" style="height: 112px;">
                            <% end %>                            
                           </div>
                          </div>
           
                        </div>
        
                        <fieldset>
                        <%= form_for(@artist) do |f| %>
                          <% if @artist.errors.any? %>
                            <div id="error_explanation">
                              <h2><%= pluralize(@artist.errors.count, "error") %> prohibited this artist from being saved:</h2>

                              <ul>
                              <% @artist.errors.full_messages.each do |msg| %>
                                <li><%= msg %></li>
                              <% end %>
                              </ul>
                            </div>
                          <% end %>
                            <legend class="section">Artist Info</legend>
                            <div class="control-group">
                                <label class="control-label" for="prefix">Artist Images</label>
                                <div class="controls controls-row">
                                  <div class="field">
                                    <%= f.fields_for :artist_images do |builder| %>
                                      <%= render 'artist_image', f: builder %>
                                    <% end %>
                                    <%= link_to_add_fields '<button type="button" class="btn btn-success"><i class="icon-plus"></i></button>'.html_safe, f, :artist_images %>
                                  </div>
                                </div>
                            </div>
                            <div class="control-group">
                                <label for="description" class="control-label">Type of Artist</label>
                                <div class="controls">
                                  <%= select :artist_type, :linkaddress, [["Person","person"],["Group", "group"]] %>
                                </div>
                            </div>
                            <div class="control-group">
                                <label for="description" class="control-label">Type of Artist</label>
                                <div class="controls">
                                  <%= select :gender, :linkaddress, [["Male","male"],["Female", "female"]] %>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label" for="stage-name">Stage Name</label>
                                <div class="controls controls-row">
                                      <%= f.text_field :name, :class => 'span8', :id => 'Name' %><!-- <button id="go" class="btn btn-primary"> Get Images </button> -->
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label" for="first-name">First Name<span class="required">*</span></label>
                                <div class="controls controls-row">
                                  <%#= f.label :first_name %>
                                  <%= f.text_field :first_name, :class => 'span4', :id => 'First Name' %>
                                <!-- <label class="control-label" for="last-name">Last Name<span class="required">*</span></label> -->
                                  <%#= f.label :last_name %>
                                  <%= f.text_field :last_name, :class => 'span4', :id => 'Last Name'  %>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label" for="biography">Biography<span class="required">*</span></label>
                                <div class="controls controls-row">
                                  <%= f.text_area :biography, :class => 'span10', :id => 'Last Name'  %>
                                </div>
                            </div>
                            <div class="control-group">
                                <label for="exp" class="control-label">Account expiration date</label>
                                <div class="controls">
                                    <input id="exp" class="input-block-level datepicker" type="text" name="exp" value="">
                                    <span class="help-block">Bootstrap datepicker</span>
                                </div>
                            </div>
                            <div class="control-group">
                                <label for="description" class="control-label">Birthday</label>
                                <div class="controls">
                                  <%= f.date_select :birthday, :class => 'input-block-level date-picker', :id => 'Birthday' %>
                                </div>
                            </div>

                        </fieldset>

                        <div class="form-actions ">
                            <!-- <button type="submit" class="btn btn-primary">Validate &amp; Submit</button> -->
                            <%= f.submit "Validate & Submit", :class => 'btn btn-primary offset3'%>
                            <button type="button" class="btn">Cancel</button>
                        </div>

                        <% end %>

                    <!-- </form> -->
                </div>
            </section>
        </div>

        <div class="span5">
          <div>
              <!-- <input id="artist" type="text" placeholder="Enter artist name ..." </input> -->
              <button id="go" class="btn btn-primary"> Get Images </button>
          </div>
          <section class="widget tiny">
            <div class="body">
              <div id="results"> </div>
            </div>
          </section>
        </div>

    </div>
</div>
</div>


<script>
 $('.datepicker').datepicker({
     format: 'mm-dd-yyyy'
 });
</script>



<script type="text/javascript">

jQuery.ajaxSettings.traditional = true; 
var apiKey = 'UJ6VUETJ7VUYJAFHB';

function fetchImages(artist) {
    var url = 'http://developer.echonest.com/api/v4/artist/images';

    var args = { 
            format:'json', 
            api_key: apiKey,
            name: artist,
            results: 100, 
    }; 

    info("Fetching images for " + artist);
    $.getJSON(url, args,
            function(data) {
                $("#results").empty();
                if (! ('images' in data.response)) {
                    error("Can't find any images for " + artist);
                } else {
                    $("#results").show();
                    $.each(data.response.images, function(index, item) {
                        var div = formatItem(index, item);
                        $("#results").append(div);
                    });
                    info("Showing " + data.response.images.length + " of " + data.response.total + " images for " + artist);
                }
            },
            function() {
                error("Trouble getting blog posts for " + artist);
            }
        );
}

function formatItem(which, item) {
    var img = $("<div>");
    img.addClass("image-container span4");
    img.css("background-image", "url(" +item.url + ")");

    var attribution = $("<span class='label'>")
        .text(item.license.attribution)
        .hide();

    img.append(attribution);
    img.hover( 
        function(evt) {
            img.find('.label').show();
        },
        function(evt) {
            img.find('.label').hide();
        }
    );
    return img;
}


function go() {
    var artist = $.trim($("#Name").val());
    if (artist.length  > 0) {
        fetchImages(artist);
    } else {
        info("Type an artist name first");
    }
}

function info(s) {
    $("#info").removeClass();
    if (s.length > 0) {
        $("#info").addClass("alert alert-info");
    }
    $("#info").text(s);
}

function error(s) {
    $("#info").removeClass();
    if (s.length > 0) {
        $("#info").addClass("alert alert-error");
    }
    $("#info").text(s);
}

$(document).ready(function() {
    // fetchApiKey will fetch the Echo Nest demo key for demos
    // hosted on The Echo Nest, otherwise it fetch an empty key
    // fetchApiKey( function(api_key, isLoggedIn) {
    //     if (!api_key) {
    //         api_key = 'MY_ECHO_NEST_API_KEY';
    //     }
        // apiKey = 'UJ6VUETJ7VUYJAFHB';
        $("#go").click(go);
        $("#Name").change(go);
    // });
});
    

</script>
